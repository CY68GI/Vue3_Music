要创建一个根据设备类型显示不同界面的音乐网站（类似Spotify/Apple Music），你可以按照以下步骤使用Vue 3实现。这里提供完整的解决方案：

### 1. 创建项目并安装依赖

```
npm create vue@latest music-website
cd music-website
npm install
npm install pinia vue-router axios
```

### 2. 项目结构

```
src/
├── assets/
├── components/
│   ├── desktop/
│   │   ├── DesktopPlayer.vue
│   │   ├── DesktopSidebar.vue
│   │   └── ...
│   └── mobile/
│       ├── MobilePlayer.vue
│       ├── MobileNavbar.vue
│       └── ...
├── layouts/
│   ├── DesktopLayout.vue
│   └── MobileLayout.vue
├── router/
│   └── index.js
├── store/
│   └── usePlayerStore.js
├── views/
│   ├── HomeView.vue
│   ├── SearchView.vue
│   ├── LibraryView.vue
│   └── ...
├── utils/
│   └── deviceDetector.js
├── App.vue
└── main.js
```

### 3. 核心代码实现

#### 设备检测工具 (`src/utils/deviceDetector.js`)

```
export const isMobileDevice = () => {
  // 方法1：通过屏幕宽度判断
  if (window.innerWidth <= 768) return true

  // 方法2：通过用户代理判断（可选）
  const userAgent = navigator.userAgent.toLowerCase();
  return /iphone|ipad|ipod|android|blackberry|windows phone/g.test(userAgent);
};

// 实时响应窗口变化
export const initResponsiveListener = (callback) => {
  window.addEventListener('resize', () => {
    callback(window.innerWidth <= 768);
  });
};
```

#### 根组件 (`src/App.vue`)

```
<template>
  <DesktopLayout v-if="!isMobile" />
  <MobileLayout v-else />
</template>

<script setup>
import { ref, onMounted, onBeforeUnmount } from 'vue';
import { isMobileDevice, initResponsiveListener } from '@/utils/deviceDetector';
import DesktopLayout from '@/layouts/DesktopLayout.vue';
import MobileLayout from '@/layouts/MobileLayout.vue';

const isMobile = ref(isMobileDevice());
let removeListener = null;

onMounted(() => {
  removeListener = initResponsiveListener((isMobileState) => {
    isMobile.value = isMobileState;
  });
});

onBeforeUnmount(() => {
  if (removeListener) removeListener();
});
</script>
```

#### 桌面端布局 (`src/layouts/DesktopLayout.vue`)

```
<template>
  <div class="desktop-layout">
    <DesktopSidebar />
    <main>
      <router-view />
    </main>
    <DesktopPlayer />
  </div>
</template>

<script setup>
import DesktopSidebar from '@/components/desktop/DesktopSidebar.vue';
import DesktopPlayer from '@/components/desktop/DesktopPlayer.vue';
</script>

<style scoped>
.desktop-layout {
  display: grid;
  grid-template-columns: 240px 1fr;
  grid-template-rows: 1fr auto;
  height: 100vh;
}

main {
  overflow-y: auto;
  padding: 20px;
}
</style>
```

#### 移动端布局 (`src/layouts/MobileLayout.vue`)

```
<template>
  <div class="mobile-layout">
    <router-view />
    <MobilePlayer />
    <MobileNavbar />
  </div>
</template>

<script setup>
import MobilePlayer from '@/components/mobile/MobilePlayer.vue';
import MobileNavbar from '@/components/mobile/MobileNavbar.vue';
</script>

<style scoped>
.mobile-layout {
  display: flex;
  flex-direction: column;
  height: 100vh;
  padding-bottom: 60px; /* 给播放器和导航栏留空间 */
}
</style>
```

### 4. 响应式设计要点

#### CSS媒体查询示例 (`src/assets/main.css`)

```
/* 全局响应式 */
@media (max-width: 768px) {
  .desktop-only {
    display: none !important;
  }
}

@media (min-width: 769px) {
  .mobile-only {
    display: none !important;
  }
}

/* 移动端样式优化 */
@media (max-width: 480px) {
  .song-card {
    width: 100%;
    margin: 5px 0;
  }
}
```

#### 播放器组件响应式处理 (`src/components/desktop/DesktopPlayer.vue`)

```
<template>
  <div class="player">
    <!-- 桌面端完整播放器控件 -->
    <button class="mobile-only" @click="openMobilePlayer">全屏播放</button>
  </div>
</template>

<script setup>
const openMobilePlayer = () => {
  // 在移动设备上打开全屏播放器
  usePlayerStore().openFullscreenPlayer();
};
</script>
```

### 5. 路由器配置 (`src/router/index.js`)

```
import { createRouter, createWebHistory } from 'vue-router';
import HomeView from '@/views/HomeView.vue';

const routes = [
  {
    path: '/',
    name: 'home',
    component: HomeView
  },
  // 其他路由...
];

const router = createRouter({
  history: createWebHistory(),
  routes,
  scrollBehavior() {
    return { top: 0 }
  }
});

export default router;
```

### 6. 状态管理 (`src/store/usePlayerStore.js`)

```
import { defineStore } from 'pinia';

export const usePlayerStore = defineStore('player', {
  state: () => ({
    currentTrack: null,
    isPlaying: false,
    fullscreenPlayer: false
  }),
  actions: {
    openFullscreenPlayer() {
      this.fullscreenPlayer = true;
      // 移动端特殊处理
      if ('ontouchstart' in window) {
        document.documentElement.requestFullscreen();
      }
    }
  }
});
```

### 7. 重要实现说明

1. ​**​设备检测双重策略​**​:
   
   - 主策略: CSS媒体查询 (`window.innerWidth`)
   - 备选策略: UA检测防止移动端横屏后切换到桌面布局

2. ​**​响应式升级方案​**​:
   
   ```
   // 监听窗口大小变化
   export const initResponsiveListener = (callback) => {
    const handler = () => callback(window.innerWidth <= 768);
    window.addEventListener('resize', handler);
    return () => window.removeEventListener('resize', handler);
   };
   ```

3. ​**​组件优化技巧​**​:
   
   - 桌面端组件使用`<keep-alive>`缓存页面
   - 移动端使用`Touch`事件优化触控体验
   - 播放器组件通过状态管理共享播放状态

### 部署注意事项

1. 在`vite.config.js`中配置PWA支持：
   
   ```
   import { VitePWA } from 'vite-plugin-pwa';
   
   export default defineConfig({
    plugins: [
      VitePWA({
        includeAssets: ['favicon.ico'],
        manifest: {
          name: 'Music App',
          short_name: 'Music',
          description: 'Modern music streaming service',
          theme_color: '#1DB954',
        },
      })
    ]
   });
   ```

2. 使用NGINX配置添加响应式重定向：
   
   ```
   location / {
    # 检查移动设备
    if ($http_user_agent ~* "(android|iphone)") {
      set $mobile_request '1';
    }
   
    # 添加X-Device-Type头
    add_header X-Device-Type $mobile_request;
   }
   ```

### 最佳实践建议

1. ​**​加载优化​**​：
   
   - 使用动态导入分离桌面/移动端组件：
     
     ```
     const MobileLayout = () => import('@/layouts/MobileLayout.vue')
     ```

2. ​**​差异化API请求​**​：
   
   ```
   axios.get('/api/data', {
    headers: {
      'X-Device-Type': isMobile.value ? 'mobile' : 'desktop'
    }
   });
   ```

3. ​**​测试方法​**​：
   
   - 开发中：Chrome设备模拟器
   - 使用Vue DevTools查看状态变化
   - 真实设备测试：iOS Safari/Android Chrome

此方案实现了：

- ✅ 自动识别设备类型显示不同UI
- ✅ 窗口大小变化时的实时响应
- ✅ 共享状态管理（播放/用户数据）
- ✅ 移动端触控友好界面
- ✅ 桌面端完整功能体验

最终效果：

- 电脑访问：显示三栏布局，左侧导航+主内容+播放控制栏
- 手机访问：显示单栏布局，底部迷你播放器+导航栏
- 横屏切换时自动调整布局（需刷新页面）
